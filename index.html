<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>P3 Email Writing Practice</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 820px; }
    .box { border: 1px solid #ccc; border-radius: 14px; padding: 16px; }
    label { display:block; margin-top: 10px; font-weight: 700; }
    input, textarea, select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #bbb; font-size: 16px; }
    textarea { min-height: 220px; line-height: 1.35; }
    button { margin-top: 14px; padding: 10px 14px; border: 0; border-radius: 12px; cursor: pointer; font-size: 16px; }
    .hint { color:#444; font-size: 0.98em; }
    .warn { margin-top: 10px; padding: 10px 12px; border-radius: 12px; background: #fff6d6; border: 1px solid #f0d27a; }
    .result { margin-top: 16px; padding: 14px; border-radius: 12px; background: #f5f5f5; white-space: pre-wrap; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 680px) { .row { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h2>P3 Email Writing Practice (Simulator)</h2>
  <p class="hint">
    This is a practice email. It does not send a real email.
  </p>
  <div class="warn">
    <strong>Safety reminder:</strong> Do not type passwords, phone numbers, home addresses, or NRIC.
    Use initials only for your name.
  </div>

  <div class="box">
    <div class="row">
      <div>
        <label>My name (use initials only)</label>
        <input id="studentName" placeholder="E.g. VS" />
      </div>
      <div>
        <label>My class</label>
        <input id="studentClass" placeholder="E.g. 3A" />
      </div>
    </div>

    <label>To</label>
    <select id="to">
      <option>formteacher@school.edu (Teacher)</option>
      <option>schooloffice@school.edu (School Office)</option>
      <option>principal@school.edu (Principal)</option>
      <option>friend@school.edu (Friend)</option>
    </select>

    <label>Subject</label>
    <input id="subject" placeholder="E.g. Request to bring a library book home" />

    <label>Message</label>
    <textarea id="message">Dear _____,

I am writing to ____________________________.

Details:
1) _________________________________________
2) _________________________________________

Thank you.

From,
________</textarea>

    <button id="checkBtn">Check my email</button>
    <button id="resetBtn" type="button">Reset template</button>

    <div id="output" class="result" style="display:none;"></div>
  </div>

  <script>
    const TEMPLATE =
`Dear _____,

I am writing to ____________________________.

Details:
1) _________________________________________
2) _________________________________________

Thank you.

From,
________`;

    function quickCheck({ subject, message, studentName, studentClass }) {
      const notes = [];

      // Basic checks (P3-friendly)
      const subjectOk = subject.trim().length >= 3;

      const msgTrim = message.trim();
      const hasGreeting = /^(dear|hi|hello)\b/i.test(msgTrim);

      const hasPurpose = /i am writing to/i.test(message);

      const hasDetailsLine = /details\s*:/i.test(message) || /\b1\)\b/.test(message);
      const enoughWords = msgTrim.split(/\s+/).filter(Boolean).length >= 25;

      const hasClosing = /\bthank you\b/i.test(message) || /\bregards\b/i.test(message) || /\byours\b/i.test(message);

      const hasFrom = /\bfrom\s*,?/i.test(message);
      const hasNameAtEnd = /from\s*,?\s*\n\s*[A-Za-z]/i.test(message) || /\n\s*[A-Za-z]{1,}\s*$/m.test(msgTrim);

      // Safety checks (gentle reminders, not punitive)
      const hasPhoneLike = /\b\d{8}\b/.test(message); // SG 8-digit pattern (rough)
      const hasNricLike = /\b[STFG]\d{7}[A-Z]\b/i.test(message);

      // Name/class (optional; encourage)
      if (!studentName.trim()) notes.push("- Add your initials in the Name box (e.g. VS).");
      if (!studentClass.trim()) notes.push("- Add your class (e.g. 3A).");

      if (!subjectOk) notes.push("- Add a subject (at least 3 letters).");
      if (!hasGreeting) notes.push("- Start with a greeting (Dear/Hi/Hello‚Ä¶).");
      if (!hasPurpose) notes.push("- Write your purpose: ‚ÄúI am writing to ‚Ä¶‚Äù");
      if (!hasDetailsLine || !enoughWords) notes.push("- Add 1‚Äì2 clear details (what / when / why).");
      if (!hasClosing) notes.push("- Add a polite closing (e.g. Thank you).");
      if (!hasFrom || !hasNameAtEnd) notes.push("- End with ‚ÄúFrom,‚Äù and your name.");

      if (hasPhoneLike) notes.push("- Remove phone numbers (safety rule).");
      if (hasNricLike) notes.push("- Remove NRIC-like information (safety rule).");

      // Stars (pick positives)
      const stars = [];
      if (subjectOk) stars.push("‚≠ê You included a subject.");
      if (hasGreeting) stars.push("‚≠ê You started with a greeting.");
      if (hasPurpose) stars.push("‚≠ê You stated your purpose.");
      if (hasDetailsLine && enoughWords) stars.push("‚≠ê You added helpful details.");
      if (hasClosing) stars.push("‚≠ê You ended politely.");
      if (hasFrom && hasNameAtEnd) stars.push("‚≠ê You signed off with your name.");

      // Ensure we always have at least 2 stars
      while (stars.length < 2) stars.push("‚≠ê Good effort ‚Äî keep going!");

      // Wish: first improvement that is not safety-related if possible
      const wish =
        (notes.find(n => !/safety rule/i.test(n)) || notes[0] || "- Try adding 1 more detail (when / where / what you need).")
          .replace(/^- /, "");

      return { stars, wish, notes };
    }

    document.getElementById("checkBtn").addEventListener("click", () => {
      const data = {
        to: document.getElementById("to").value,
        subject: document.getElementById("subject").value,
        message: document.getElementById("message").value,
        studentName: document.getElementById("studentName").value,
        studentClass: document.getElementById("studentClass").value
      };

      const { stars, wish, notes } = quickCheck(data);

      const out = document.getElementById("output");
      out.style.display = "block";
      out.textContent =
        `2 Stars ‚≠ê‚≠ê\n- ${stars[0]}\n- ${stars[1]}\n\n` +
        `1 Wish üå±\n- ${wish}\n\n` +
        (notes.length ? `Teacher notes (optional):\n${notes.join("\n")}\n\n` : "") +
        `Reminder: Do not type passwords, phone numbers, home addresses, or NRIC.`;
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      document.getElementById("message").value = TEMPLATE;
      document.getElementById("output").style.display = "none";
      document.getElementById("output").textContent = "";
    });
  </script>
</body>
</html>
